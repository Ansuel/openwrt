From fc7e45f187fb91a5e735c12e1d870e7170147776 Mon Sep 17 00:00:00 2001
From: Michal Hrusecky <michal.hrusecky@nic.cz>
Date: Fri, 13 Jul 2018 14:02:01 +0200
Subject: [PATCH] twisted: Update to the latest version

---
 lang/twisted/Makefile                         |  7 ++--
 .../patches/001-fix-zsh-completion.patch      |  9 ------
 lang/twisted/patches/002-omit-tests.patch     | 32 -------------------
 3 files changed, 4 insertions(+), 44 deletions(-)
 delete mode 100644 lang/twisted/patches/001-fix-zsh-completion.patch
 delete mode 100644 lang/twisted/patches/002-omit-tests.patch

diff --git a/lang/twisted/Makefile b/lang/twisted/Makefile
index 0b917ddf..10eee375 100644
--- a/lang/twisted/Makefile
+++ b/lang/twisted/Makefile
@@ -8,13 +8,13 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=twisted
-PKG_VERSION:=16.0.0
+PKG_VERSION:=18.4.0
 PKG_RELEASE:=1
 
 PKG_SOURCE:=Twisted-$(PKG_VERSION).tar.bz2
 PKG_SOURCE_URL:=https://pypi.python.org/packages/source/T/Twisted \
-		http://twistedmatrix.com/Releases/Twisted/16.0
-PKG_MD5SUM:=c6aa35e9a1e40fce6797247f39647d2a
+		http://twistedmatrix.com/Releases/Twisted/18.4
+PKG_MD5SUM:=da8142ad4e9971a75fe751ac96a33b95
 
 PKG_BUILD_DIR:=$(BUILD_DIR)/Twisted-$(PKG_VERSION)
 PKG_BUILD_DEPENDS:=python python-setuptools USE_MUSL:librpc
@@ -29,6 +29,7 @@ $(call include_mk, python-package.mk)
 define Package/twisted
   SUBMENU:=Python
   SECTION:=lang
+  PROVIDES:=python-twisted
   CATEGORY:=Languages
   TITLE:=Python networking engine
   URL:=http://twistedmatrix.com/
diff --git a/lang/twisted/patches/001-fix-zsh-completion.patch b/lang/twisted/patches/001-fix-zsh-completion.patch
deleted file mode 100644
index f7b04869..00000000
--- a/lang/twisted/patches/001-fix-zsh-completion.patch
+++ /dev/null
@@ -1,9 +0,0 @@
-diff -Nur a/twisted/python/twisted-completion.zsh b/twisted/python/twisted-completion.zsh
---- a/twisted/python/twisted-completion.zsh	2015-11-29 11:30:47.000000000 +0800
-+++ b/twisted/python/twisted-completion.zsh	2015-11-30 20:05:59.755695237 +0800
-@@ -1,4 +1,4 @@
--#compdef twistd trial conch cftp ckeygen pyhtmlizer tap2deb tkconch manhole tap2rpm
-+#compdef twistd trial conch cftp ckeygen pyhtmlizer
- #
- # This is the ZSH completion file for Twisted commands. It calls the current
- # command-line with the special "--_shell-completion" option which is handled
diff --git a/lang/twisted/patches/002-omit-tests.patch b/lang/twisted/patches/002-omit-tests.patch
deleted file mode 100644
index 58c004fc..00000000
--- a/lang/twisted/patches/002-omit-tests.patch
+++ /dev/null
@@ -1,32 +0,0 @@
-diff -Nur a/setup.py b/setup.py
---- a/setup.py	2015-11-29 11:30:46.000000000 +0800
-+++ b/setup.py	2015-12-02 18:22:10.251268303 +0800
-@@ -49,11 +49,11 @@
-     scripts = getScripts()
- 
-     setup_args.update(dict(
--        packages=getPackages('twisted'),
-+        packages=getPackages('twisted', ignore=['test']),
-         conditionalExtensions=getExtensions(),
-         scripts=scripts,
-         extras_require=_EXTRAS_REQUIRE,
--        data_files=getDataFiles('twisted'),
-+        data_files=getDataFiles('twisted', ignore=['test']),
-         **STATIC_PACKAGE_METADATA))
- 
-     setup(**setup_args)
-diff -Nur a/twisted/python/dist.py b/twisted/python/dist.py
---- a/twisted/python/dist.py	2015-11-29 11:30:47.000000000 +0800
-+++ b/twisted/python/dist.py	2015-12-02 19:21:20.076370379 +0800
-@@ -268,11 +268,6 @@
-     """
-     extensions = [
-         ConditionalExtension(
--            "twisted.test.raiser",
--            ["twisted/test/raiser.c"],
--            condition=lambda _: _isCPython),
--
--        ConditionalExtension(
-             "twisted.internet.iocpreactor.iocpsupport",
-             ["twisted/internet/iocpreactor/iocpsupport/iocpsupport.c",
-              "twisted/internet/iocpreactor/iocpsupport/winsock_pointers.c"],
-- 
2.18.0

