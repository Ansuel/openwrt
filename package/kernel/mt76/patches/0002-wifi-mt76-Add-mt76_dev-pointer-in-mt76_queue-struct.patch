From 7e81db91e0f70abfde3a5f7a21cc6f9e9a5bd72f Mon Sep 17 00:00:00 2001
Message-ID: <7e81db91e0f70abfde3a5f7a21cc6f9e9a5bd72f.1757512252.git.lorenzo@kernel.org>
In-Reply-To: <e134420e2a93d0febe112f1459b27b26a87017c4.1757512252.git.lorenzo@kernel.org>
References: <e134420e2a93d0febe112f1459b27b26a87017c4.1757512252.git.lorenzo@kernel.org>
From: Lorenzo Bianconi <lorenzo@kernel.org>
Date: Mon, 14 Jul 2025 13:57:57 +0200
Subject: [PATCH 2/5] wifi: mt76: Add mt76_dev pointer in mt76_queue struct.

This is a preliminary patch to enable traffic forward offloading via the
Airoha NPU module available on the Airoha EN7581 SoC.

Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
---
 dma.c  | 1 +
 mt76.h | 1 +
 2 files changed, 2 insertions(+)

diff --git a/dma.c b/dma.c
index f21481d4..a285fd0a 100644
--- a/dma.c
+++ b/dma.c
@@ -794,6 +794,7 @@ mt76_dma_alloc_queue(struct mt76_dev *dev, struct mt76_queue *q,
 	q->ndesc = n_desc;
 	q->buf_size = bufsize;
 	q->hw_idx = idx;
+	q->dev = dev;
 
 	size = mt76_queue_is_wed_rro_ind(q) ? sizeof(struct mt76_wed_rro_desc)
 					    : sizeof(struct mt76_desc);
diff --git a/mt76.h b/mt76.h
index 9b265aed..9788fbb1 100644
--- a/mt76.h
+++ b/mt76.h
@@ -252,6 +252,7 @@ struct mt76_queue {
 	__le16 *emi_cpu_idx;
 
 	struct mtk_wed_device *wed;
+	struct mt76_dev *dev;
 	u32 wed_regs;
 
 	dma_addr_t desc_dma;
-- 
2.51.0

