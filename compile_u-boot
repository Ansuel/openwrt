#!/bin/bash -e
ELDK_ENV_FILE=/opt/eldk-5.2.1/powerpc-e500v2/environment-setup-ppce500v2-linux-gnuspe
if [ ! -f $ELDK_ENV_FILE ]; then 
	echo -e "\033[31m"
	echo "###########################################################################################################"
	echo "#                                                                                                         #"
	echo "# WARNING: You do NOT have ELDK installed or your ELDK_ENV_FILE variable is wrong. U-BOOT can't be built. #"
	echo "#                                                                                                         #"
	echo "###########################################################################################################"
	echo -e "\033[m"	

	exit 0
fi


#Build boot-format
./compile_boot-format

# set up environment
source $ELDK_ENV_FILE

make -C ./u-boot CROSS_COMPILE=powerpc-linux-gnuspe- clean
make -C ./u-boot  CROSS_COMPILE=powerpc-linux-gnuspe- TURRIS1_SDCARD_config
make -C ./u-boot CROSS_COMPILE=powerpc-linux-gnuspe-
./boot-format/boot_format ./boot-format/config_sram_p2020ds.dat ./u-boot/u-boot.bin -spi ./u-boot/u-boot.sdcard.bin

make -C ./u-boot CROSS_COMPILE=powerpc-linux-gnuspe- clean
make -C ./u-boot CROSS_COMPILE=powerpc-linux-gnuspe- TURRIS1_config
make -C ./u-boot CROSS_COMPILE=powerpc-linux-gnuspe-

